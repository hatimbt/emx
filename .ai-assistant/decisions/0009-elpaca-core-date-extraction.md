# Decision Record 0009: Elpaca Core Date Extraction

## Context

Elpaca, the package manager for Emacs Lisp packages, requires `elpaca-core-date` to be set when using development versions of Emacs. This date is used to match built-in package versions against MELPA's date-versioning scheme. When using Nix to manage the Emacs binary, we need to extract this build date from the package information.

Development versions of Emacs (like emacs-git-pgtk) from the emacs-overlay often include a date in their package name or store path in the format `YYYYMMDD`, which can be used to set `elpaca-core-date`.

## Decision

We've implemented a mechanism in the Nix home-module that:

1. Extracts the build date from the full Nix store path of the Emacs package
2. Uses regex pattern matching to find an 8-digit date pattern (YYYYMMDD)
3. Sets `elpaca-core-date` in the init.el shim before any other Emacs code runs

This ensures that Elpaca gets the correct build date for the specific Emacs binary being used, preventing warnings and ensuring proper package compatibility.

## Implementation

The implementation uses Nix's string manipulation functions to:
- Convert the package path to a string with `toString cfg.package`
- Match an 8-digit date pattern with `builtins.match ".*-([0-9]{8}).*" packagePath`
- Extract the matched date and convert it to the format Elpaca expects
- Set `elpaca-core-date` in the init.el shim that's generated by the home-module

## References

- [Elpaca Wiki: Warnings and Errors](https://github.com/progfolio/elpaca/wiki/Warnings-and-Errors)